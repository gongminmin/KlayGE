SET(LIB_NAME FreeImage)

SET(FREEIMAGE_LIB_SOURCE_FILES
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImage/BitmapAccess.cpp
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImage/ColorLookup.cpp
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImage/FreeImage.cpp
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImage/FreeImageC.c
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImage/FreeImageIO.cpp
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImage/GetType.cpp
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImage/MemoryIO.cpp
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImage/PixelAccess.cpp
)
IF(KLAYGE_PLATFORM_WINDOWS)
	SET(FREEIMAGE_LIB_SOURCE_FILES ${FREEIMAGE_LIB_SOURCE_FILES}
		${FREEIMAGE_PROJECT_DIR}/FreeImage.rc
	)
ENDIF()
SET(FREEIMAGE_LIB_CONVERSION_SOURCE_FILES
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImage/Conversion.cpp
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImage/Conversion4.cpp
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImage/Conversion8.cpp
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImage/Conversion16_555.cpp
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImage/Conversion16_565.cpp
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImage/Conversion24.cpp
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImage/Conversion32.cpp
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImage/ConversionFloat.cpp
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImage/ConversionRGB16.cpp
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImage/ConversionRGBA16.cpp
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImage/ConversionRGBAF.cpp
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImage/ConversionRGBF.cpp
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImage/ConversionType.cpp
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImage/ConversionUINT16.cpp
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImage/Halftoning.cpp
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImage/tmoColorConvert.cpp
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImage/tmoDrago03.cpp
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImage/tmoFattal02.cpp
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImage/tmoReinhard05.cpp
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImage/ToneMapping.cpp
)
SET(FREEIMAGE_LIB_METADATA_SOURCE_FILES
	${FREEIMAGE_PROJECT_DIR}/Source/Metadata/Exif.cpp
	${FREEIMAGE_PROJECT_DIR}/Source/Metadata/FIRational.cpp
	${FREEIMAGE_PROJECT_DIR}/Source/Metadata/FreeImageTag.cpp
	${FREEIMAGE_PROJECT_DIR}/Source/Metadata/IPTC.cpp
	${FREEIMAGE_PROJECT_DIR}/Source/Metadata/TagConversion.cpp
	${FREEIMAGE_PROJECT_DIR}/Source/Metadata/TagLib.cpp
	${FREEIMAGE_PROJECT_DIR}/Source/Metadata/XTIFF.cpp
)
SET(FREEIMAGE_LIB_MULTI_PAGING_SOURCE_FILES
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImage/CacheFile.cpp
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImage/MultiPage.cpp
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImage/ZLibInterface.cpp
)
SET(FREEIMAGE_LIB_PLUGINS_SOURCE_FILES
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImage/J2KHelper.cpp
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImage/MNGHelper.cpp
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImage/Plugin.cpp
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImage/PluginBMP.cpp
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImage/PluginCUT.cpp
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImage/PluginDDS.cpp
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImage/PluginEXR.cpp
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImage/PluginG3.cpp
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImage/PluginGIF.cpp
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImage/PluginHDR.cpp
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImage/PluginICO.cpp
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImage/PluginIFF.cpp
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImage/PluginJ2K.cpp
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImage/PluginJNG.cpp
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImage/PluginJP2.cpp
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImage/PluginJPEG.cpp
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImage/PluginJXR.cpp
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImage/PluginKOALA.cpp
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImage/PluginMNG.cpp
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImage/PluginPCD.cpp
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImage/PluginPCX.cpp
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImage/PluginPFM.cpp
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImage/PluginPICT.cpp
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImage/PluginPNG.cpp
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImage/PluginPNM.cpp
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImage/PluginPSD.cpp
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImage/PluginRAS.cpp
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImage/PluginRAW.cpp
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImage/PluginSGI.cpp
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImage/PluginTARGA.cpp
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImage/PluginTIFF.cpp
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImage/PluginWBMP.cpp
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImage/PluginWebP.cpp
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImage/PluginXBM.cpp
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImage/PluginXPM.cpp
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImage/PSDParser.cpp
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImage/TIFFLogLuv.cpp
)
SET(FREEIMAGE_LIB_QUANTIZERS_SOURCE_FILES
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImage/LFPQuantizer.cpp
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImage/NNQuantizer.cpp
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImage/WuQuantizer.cpp
)
SET(FREEIMAGE_LIB_TOOLKIT_FILES
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImageToolkit/Background.cpp
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImageToolkit/BSplineRotate.cpp
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImageToolkit/Channels.cpp
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImageToolkit/ClassicRotate.cpp
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImageToolkit/Colors.cpp
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImageToolkit/CopyPaste.cpp
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImageToolkit/Display.cpp
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImageToolkit/Flip.cpp
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImageToolkit/JPEGTransform.cpp
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImageToolkit/MultigridPoissonSolver.cpp
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImageToolkit/Rescale.cpp
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImageToolkit/Resize.cpp
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImageToolkit/Resize.h
)
SET(FREEIMAGE_LIB_HEADER_FILES
	${FREEIMAGE_PROJECT_DIR}/Source/CacheFile.h
	${FREEIMAGE_PROJECT_DIR}/Source/Metadata/FIRational.h
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImage.h
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImageIO.h
	${FREEIMAGE_PROJECT_DIR}/Source/Metadata/FreeImageTag.h
	${FREEIMAGE_PROJECT_DIR}/Source/MapIntrospector.h
	${FREEIMAGE_PROJECT_DIR}/Source/Plugin.h
	${FREEIMAGE_PROJECT_DIR}/Source/FreeImage/PSDParser.h
	${FREEIMAGE_PROJECT_DIR}/Source/Quantizers.h
	${FREEIMAGE_PROJECT_DIR}/Source/ToneMapping.h
	${FREEIMAGE_PROJECT_DIR}/Source/Utilities.h
)
SOURCE_GROUP("Source Files" FILES ${FREEIMAGE_LIB_SOURCE_FILES})
SOURCE_GROUP("Source Files\\Conversion" FILES ${FREEIMAGE_LIB_CONVERSION_SOURCE_FILES})
SOURCE_GROUP("Source Files\\DeprecationMgr" FILES ${FREEIMAGE_LIB_DEPRECATION_MGR_SOURCE_FILES})
SOURCE_GROUP("Source Files\\Metadata" FILES ${FREEIMAGE_LIB_METADATA_SOURCE_FILES})
SOURCE_GROUP("Source Files\\MultiPaging" FILES ${FREEIMAGE_LIB_MULTI_PAGING_SOURCE_FILES})
SOURCE_GROUP("Source Files\\Plugins" FILES ${FREEIMAGE_LIB_PLUGINS_SOURCE_FILES})
SOURCE_GROUP("Source Files\\Quantizers" FILES ${FREEIMAGE_LIB_QUANTIZERS_SOURCE_FILES})
SOURCE_GROUP("Header Files" FILES ${FREEIMAGE_LIB_HEADER_FILES})
SOURCE_GROUP("Toolkit Files" FILES ${FREEIMAGE_LIB_TOOLKIT_FILES})

ADD_DEFINITIONS(-DOPJ_STATIC)
ADD_DEFINITIONS(-DFREEIMAGE_EXPORTS)
IF(KLAYGE_PLATFORM_WINDOWS)
	ADD_DEFINITIONS(-D_CRT_SECURE_NO_DEPRECATE)
ENDIF()
ADD_DEFINITIONS(-DLIBRAW_NODLL)
INCLUDE_DIRECTORIES(${FREEIMAGE_PROJECT_DIR}/Source)
INCLUDE_DIRECTORIES(${FREEIMAGE_PROJECT_DIR}/Source/ZLib)
INCLUDE_DIRECTORIES(${FREEIMAGE_PROJECT_DIR}/Source/OpenEXR)
INCLUDE_DIRECTORIES(${FREEIMAGE_PROJECT_DIR}/Source/OpenEXR/Half)
INCLUDE_DIRECTORIES(${FREEIMAGE_PROJECT_DIR}/Source/OpenEXR/Iex)
INCLUDE_DIRECTORIES(${FREEIMAGE_PROJECT_DIR}/Source/OpenEXR/IlmImf)
INCLUDE_DIRECTORIES(${FREEIMAGE_PROJECT_DIR}/Source/OpenEXR/Imath)
INCLUDE_DIRECTORIES(${FREEIMAGE_PROJECT_DIR}/Source/OpenEXR/IlmThread)
INCLUDE_DIRECTORIES(${FREEIMAGE_PROJECT_DIR}/Source/LibJXR/jxrgluelib)
INCLUDE_DIRECTORIES(${FREEIMAGE_PROJECT_DIR}/Source/LibJXR/image/sys)
IF(NOT KLAYGE_COMPILER_MSVC)
	INCLUDE_DIRECTORIES(${FREEIMAGE_PROJECT_DIR}/Source/LibJXR/common/include)
ENDIF()
LINK_DIRECTORIES(${FREEIMAGE_OUTPUT_DIR})
ADD_LIBRARY(${LIB_NAME} SHARED
	${FREEIMAGE_LIB_SOURCE_FILES} ${FREEIMAGE_LIB_CONVERSION_SOURCE_FILES} ${FREEIMAGE_LIB_DEPRECATION_MGR_SOURCE_FILES}
	${FREEIMAGE_LIB_METADATA_SOURCE_FILES} ${FREEIMAGE_LIB_MULTI_PAGING_SOURCE_FILES} ${FREEIMAGE_LIB_PLUGINS_SOURCE_FILES}
	${FREEIMAGE_LIB_QUANTIZERS_SOURCE_FILES} ${FREEIMAGE_LIB_HEADER_FILES} ${FREEIMAGE_LIB_TOOLKIT_FILES}
)
ADD_DEPENDENCIES(${LIB_NAME} LibJPEG LibJXR LibOpenJPEG LibPNG LibRaw LibTIFF4 LibWebP OpenEXR ZLib)

SET_TARGET_PROPERTIES(${LIB_NAME} PROPERTIES
	ARCHIVE_OUTPUT_DIRECTORY ${FREEIMAGE_OUTPUT_DIR}
	ARCHIVE_OUTPUT_DIRECTORY_DEBUG ${FREEIMAGE_OUTPUT_DIR}
	ARCHIVE_OUTPUT_DIRECTORY_RELEASE ${FREEIMAGE_OUTPUT_DIR}
	ARCHIVE_OUTPUT_DIRECTORY_RELWITHDEBINFO ${FREEIMAGE_OUTPUT_DIR}
	ARCHIVE_OUTPUT_DIRECTORY_MINSIZEREL ${FREEIMAGE_OUTPUT_DIR}
	PROJECT_LABEL ${LIB_NAME}
	DEBUG_POSTFIX ${CMAKE_DEBUG_POSTFIX}
	OUTPUT_NAME ${LIB_NAME}${KLAYGE_OUTPUT_SUFFIX}
)
IF(KLAYGE_PLATFORM_DARWIN OR KLAYGE_PLATFORM_LINUX)
	SET_TARGET_PROPERTIES(${LIB_NAME} PROPERTIES
		LIBRARY_OUTPUT_DIRECTORY ${KLAYGE_BIN_DIR}
		LIBRARY_OUTPUT_DIRECTORY_DEBUG ${KLAYGE_BIN_DIR}
		LIBRARY_OUTPUT_DIRECTORY_RELEASE ${KLAYGE_BIN_DIR}
		LIBRARY_OUTPUT_DIRECTORY_RELWITHDEBINFO ${KLAYGE_BIN_DIR}
		LIBRARY_OUTPUT_DIRECTORY_MINSIZEREL ${KLAYGE_BIN_DIR})
ENDIF()

TARGET_LINK_LIBRARIES(${LIB_NAME}
	debug LibJPEG${KLAYGE_OUTPUT_SUFFIX}${CMAKE_DEBUG_POSTFIX} optimized LibJPEG${KLAYGE_OUTPUT_SUFFIX}
	debug LibJXR${KLAYGE_OUTPUT_SUFFIX}${CMAKE_DEBUG_POSTFIX} optimized LibJXR${KLAYGE_OUTPUT_SUFFIX}
	debug LibOpenJPEG${KLAYGE_OUTPUT_SUFFIX}${CMAKE_DEBUG_POSTFIX} optimized LibOpenJPEG${KLAYGE_OUTPUT_SUFFIX}
	debug LibPNG${KLAYGE_OUTPUT_SUFFIX}${CMAKE_DEBUG_POSTFIX} optimized LibPNG${KLAYGE_OUTPUT_SUFFIX}
	debug LibRaw${KLAYGE_OUTPUT_SUFFIX}${CMAKE_DEBUG_POSTFIX} optimized LibRaw${KLAYGE_OUTPUT_SUFFIX}
	debug LibTIFF4${KLAYGE_OUTPUT_SUFFIX}${CMAKE_DEBUG_POSTFIX} optimized LibTIFF4${KLAYGE_OUTPUT_SUFFIX}
	debug LibWebP${KLAYGE_OUTPUT_SUFFIX}${CMAKE_DEBUG_POSTFIX} optimized LibWebP${KLAYGE_OUTPUT_SUFFIX}
	debug OpenEXR${KLAYGE_OUTPUT_SUFFIX}${CMAKE_DEBUG_POSTFIX} optimized OpenEXR${KLAYGE_OUTPUT_SUFFIX}
	debug ZLib${KLAYGE_OUTPUT_SUFFIX}${CMAKE_DEBUG_POSTFIX} optimized ZLib${KLAYGE_OUTPUT_SUFFIX}
)
IF(KLAYGE_PLATFORM_WINDOWS AND (NOT KLAYGE_COMPILER_MSVC))
	TARGET_LINK_LIBRARIES(${LIB_NAME}
		ws2_32
	)
ENDIF()

IF(KLAYGE_PLATFORM_WINDOWS)
	INSTALL(TARGETS ${LIB_NAME}
		RUNTIME DESTINATION ${KLAYGE_BIN_DIR}
		LIBRARY DESTINATION ${KLAYGE_BIN_DIR}
	)
ENDIF()
