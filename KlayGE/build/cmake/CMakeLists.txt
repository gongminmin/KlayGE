SET(CMAKE_MODULE_PATH "${CMAKE_CURRENT_SOURCE_DIR}/../../../cmake;${CMAKE_MODULE_PATH}")

PROJECT(KlayGE)

CMAKE_MINIMUM_REQUIRED(VERSION 2.8.6)

IF(COMMAND cmake_policy)
	CMAKE_POLICY(SET CMP0003 NEW)
ENDIF(COMMAND cmake_policy)

SET(KLAYGE_MAJOR_VERSION 4)
SET(KLAYGE_MINOR_VERSION 1)
SET(KLAYGE_PATCH_VERSION 0)
SET(KLAYGE_VERSION ${KLAYGE_MAJOR_VERSION}.${KLAYGE_MINOR_VERSION}.${KLAYGE_PATCH_VERSION})

FIND_PATH(KLAYGE_PROJECT_DIR klayge_logo.ico PATHS ../../)
SET(KLAYGE_ROOT_DIR "${KLAYGE_PROJECT_DIR}/..")

INCLUDE(${KLAYGE_PROJECT_DIR}/../cmake/Common.cmake)
INCLUDE(${KLAYGE_PROJECT_DIR}/../cmake/Platform.cmake)
INCLUDE(${KLAYGE_PROJECT_DIR}/../cmake/Compiler.cmake)

SET_PROPERTY(GLOBAL PROPERTY USE_FOLDERS ON)

# Main settings and dependencies
SET(KLAYGE_CORELIB_NAME KlayGE_Core)  # Dependency of all other targets

SET(KLAYGE_OUTPUT_DIR "${KLAYGE_PROJECT_DIR}/lib/${KLAYGE_PLATFORM_NAME}")
SET(KLAYGE_BIN_DIR "${KLAYGE_PROJECT_DIR}/bin/${KLAYGE_PLATFORM_NAME}")

# Target name postfix
SET(KLAYGE_NAME_POSTFIX "_${KLAYGE_COMPILER_NAME}")

# Projects
ADD_SUBDIRECTORY(Core)

IF(NOT KLAYGE_BUILD_PLATFORM_WINRT)
	ADD_SUBDIRECTORY(Plugins/Render/OpenGL)
	ADD_SUBDIRECTORY(Plugins/Render/OpenGLES)

	ADD_SUBDIRECTORY(Plugins/Audio/OpenAL)
	ADD_SUBDIRECTORY(Plugins/Audio/OggVorbis)
ENDIF()

ADD_SUBDIRECTORY(Plugins/Scene/OCTree)

IF(WIN32)
	ADD_SUBDIRECTORY(Plugins/Input/MsgInput)
	ADD_SUBDIRECTORY(Plugins/Render/D3D11)

	IF(NOT KLAYGE_BUILD_PLATFORM_WINRT)
		ADD_SUBDIRECTORY(Plugins/Audio/DSound)
		ADD_SUBDIRECTORY(Plugins/Show/DShow)
		ADD_SUBDIRECTORY(Plugins/Script/Python)
		ADD_SUBDIRECTORY(KGEConfig)
	ENDIF()
ENDIF(WIN32)
